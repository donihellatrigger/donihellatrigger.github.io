<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генерация изображений с Grok</title>
    <!-- Стили остаются без изменений -->
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; margin: 0; padding: 10px; }
        #prompt { width: 100%; max-width: 400px; height: 100px; margin: 20px auto; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        #generate { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #generate:hover { background-color: #0056b3; }
        #canvas { margin-top: 20px; border: 1px solid #ccc; width: 100%; max-width: 400px; height: auto; }
    </style>
</head>
<body>
    <h2>Генерация изображений с Grok</h2>
    <textarea id="prompt" placeholder="Введите описание, например: 'Кот в аниме-стиле'"></textarea><br>
    <button id="generate">Сгенерировать изображение</button><br>
    <canvas id="canvas" width="400" height="400"></canvas>

    <script>
        document.getElementById('generate').addEventListener('click', async function() {
            const prompt = document.getElementById('prompt').value;
            if (!prompt) return alert('Пожалуйста, введите описание');

            if (!confirm(`Сгенерировать: "${prompt}"?`)) return;

            try {
                // 1. Запрос к API для генерации изображения
                const apiResponse = await fetch('https://api.x.ai/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer xai-G6eIlPHKSoNNTATdRwtUhFsEfaJDp9g9ljjkqyzQWjFi50FW5rmlZQTwsZhEvxx0CrocYrUVffvzkW8E',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        model: 'grok-2-image-1212',
                        width: 400,
                        height: 400,
                        n: 1
                    })
                });

                if (!apiResponse.ok) throw new Error(`API Error: ${apiResponse.status}`);
                
                // 2. Получение URL изображения
                const { data: [{ url }] } = await apiResponse.json();
                
                // 3. Обход CORS через proxy
                const imgResponse = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                const blob = await imgResponse.blob();
                
                // 4. Отрисовка на canvas
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                };
                
                img.onerror = (e) => {
                    console.error('Image load error:', e);
                    alert('Ошибка загрузки изображения');
                };
                
                img.src = URL.createObjectURL(blob);

            } catch (error) {
                console.error('Error:', error);
                alert(`Ошибка: ${error.message}`);
            }
        });
    </script>
</body>
</html>
